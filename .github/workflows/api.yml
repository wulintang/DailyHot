name: Build and Deploy
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 关键步骤：生成或修改 .env 文件，写入环境变量
      - name: Create/Update .env file
        run: |
          # 写入 .env 文件（如果文件已存在，会覆盖或追加）
          echo "# 全局 API 地址" > .env
          echo "VITE_GLOBAL_API=${{ secrets.GLOBAL_API }}" >> .env  # 从 secrets 读取
          echo "" >> .env
          echo "# ICP 备案号" >> .env
          echo "VITE_ICP=\"\"" >> .env
          echo "" >> .env
          echo "# 全局目录" >> .env
          echo "VITE_DIR=\"/\"" >> .env

          # 可选：查看 .env 内容（确认是否正确写入，注意不要泄露敏感信息）
          cat .env

      - name: Install dependencies
        run: npm install

      - name: Build project
        run: npm run build  # 此时项目读取 .env 会获得注入的值
